#! /usr/bin/env nextflow

nextflow.enable.dsl=2

process SHUFFLE_INTERSECT {

	container "https://depot.galaxyproject.org/singularity/bedtools:2.30.0--hc088bd4_0"

	input:
	val(iteration)
	tuple path(bed_of_int)
	path(genome_sizes)
	tuple val(condition_name), path(motifs), path(consensus)

	output:
	tuple val(condition_name), path("tfbs_counts.tsv"), emit: results 

script:
"""
mkdir ${params.outdir}/permutation_results
bedtools shuffle -i ${bed_of_int} -g ${genome_sizes} -incl ${consensus} -noOverlapping -f 1 | bedtools intersect -a stdin -b ${motifs} -wb -F 1 | head -6 

"""
}

workflow {  \\define the workflow scope concatenating the processes

idx = 	Channel
	    .of(1..3)

data = Channel.fromPath(params.motifs)
	      .splitCsv(header: true)
	      .map {row -> [row.condition, file(row.path), file(row.consensus)]}


SHUFFLE_INTERSECT (
		  idx,
		  data,
		  params.motifs)


SHUFFLE_INTERSECT
.out.results.view()
\\.results
\\.rintesct
\\.collectFile(name:'TFBS_shuffled_intersection.bed', newLine: true)

}
