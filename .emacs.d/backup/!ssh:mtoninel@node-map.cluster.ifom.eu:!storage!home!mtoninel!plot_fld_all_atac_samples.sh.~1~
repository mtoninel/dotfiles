#! usr/bin/bash

# Initialize variable
BAM_DIR=""

usage () { echo "$0 [-d BAM_DIR]

This small script is used to generate data tables containing the information of fragment length and fragment length frequency among ATAC-seq samples. It uses BAM files and needs a working installation of SAMtools. The only required input is a directory containing some BAM files.
" 1>&2
	 }

while getopts {d:} options; do
    case "${options}" in
	d) BAM_DIR=${OPTARG}
	   if [[ ! -d "${BAM_DIR}" ]]
	   then
	       echo "${BAM_DIR} does not exist!"
	       exit 1
	   fi
    esac
done
shift "$((OPTIND-1))"

# Check directory of input
if [[ ! -d "${BAM_DIR}" ]]
then
    echo "Input files directory not valid!"
    usage
    exit 1
fi

# Plotting tables generation
for bamfile in $BAM_DIR/*.bam
do
    echo -e $bamfile
    # samtools view $bamfile | awk '$9>0' | cut -f 9 | sort | uniq -c | sort -b -k2,2n | sed -e 's/^[ \t]*//' > fragment_length_count_.txt
done
